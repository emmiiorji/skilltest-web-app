const startScript=()=>{navigator.clipboard;const e=void 0!==navigator.deviceMemory,t=void 0!==navigator.hardwareConcurrency,n=(window.WebGLRenderingContext,!(!window.AudioContext&&!window.webkitAudioContext)),a="undefined"!=typeof Intl,r=Date.now();let o="",i=[],s=[],c=[],d=[],u=[],l=null,m=null,g={},p="desktop";const v=window.trackingConfig||{},w=!v.disableFocusEvents,h=!v.disableClipboardEvents,y=!v.disablePreSubmitDelay,f=!v.disableAnswerChangeEvents,b=!v.disableDeviceFingerprint,_=!v.disableTimeToFirstInteraction,E=!v.disableMouseClickEvents,k=!v.disableKeyboardPressEvents;fetch("https://api.ipify.org").then((e=>e.text())).then((e=>{o=e}));p=(()=>{const e=navigator.userAgent.toLowerCase(),t=/mobile|android|iphone|ipad|phone/i.test(e);return/tablet|ipad/i.test(e)?"tablet":t?"mobile":"desktop"})();let S=document.hasFocus()?"active":"inactive",D=Date.now(),C=0;w&&i.push({timestamp:D,duration_ms:0,type:S});const L=e=>{const t=Date.now(),n=t-D;"inactive"===S&&(C+=n),w&&(i.length>0&&(i[i.length-1].duration_ms=n),i.push({timestamp:t,duration_ms:0,type:e})),S=e,D=t};if(window.addEventListener("blur",(()=>{"inactive"!==S&&L("inactive")})),window.addEventListener("focus",(()=>{"active"!==S&&L("active")})),window.addEventListener("beforeunload",(()=>{const e=Date.now()-D;"inactive"===S&&(C+=e),w&&i.length>0&&(i[i.length-1].duration_ms=e)})),h){const e=()=>{const e=window.getSelection().toString().trim();e.length>0&&s.push({timestamp:Date.now(),type:"copy",content:e.substring(0,100)})},t=e=>{const t=(e.clipboardData?.getData("text/plain")||"").trim();t.length>0&&s.push({timestamp:Date.now(),type:"paste",content:t.substring(0,100)})},n=()=>{const e=window.getSelection().toString().trim();e.length>0&&s.push({timestamp:Date.now(),type:"cut",content:e.substring(0,100)})};document.addEventListener("copy",e),document.addEventListener("paste",t),document.addEventListener("cut",n)}if(f){const e=(e,t,n)=>{const a=document.querySelector('input[name="question_id"]').value;c.push({question_id:parseInt(a),previous_answer:t,new_answer:n,timestamp:Date.now(),input_type:e.type||"text"}),m=Date.now()},t=t=>{if(("answer"===t.target.name||t.target.name?.startsWith("answer-"))&&"radio"!==t.target.type&&"checkbox"!==t.target.type){const n=t.target.dataset.previousValue||"";e(t.target,n,t.target.value),t.target.dataset.previousValue=t.target.value}},n=t=>{if(("radio"===t.target.type||"checkbox"===t.target.type)&&("answer"===t.target.name||t.target.name?.startsWith("answer-"))){const n=t.target.dataset.previousValue||"";e(t.target,n,t.target.value),t.target.dataset.previousValue=t.target.value}};document.addEventListener("input",t),document.addEventListener("change",n)}if(E){const e=((e,t)=>{let n;return function(){const a=arguments,r=this;n||(e.apply(r,a),n=!0,setTimeout((()=>n=!1),t))}})((e=>{d.push({timestamp:Date.now(),button:0===e.button?"left":2===e.button?"right":"middle",x:e.clientX,y:e.clientY,target:e.target.tagName+(e.target.id?"#"+e.target.id:"")})}),100);document.addEventListener("click",e),document.addEventListener("contextmenu",e)}if(k){const e=((e,t)=>{let n;return function(){const a=arguments,r=this;n||(e.apply(r,a),n=!0,setTimeout((()=>n=!1),t))}})((e=>{let t="other";e.key.match(/^[a-zA-Z]$/)?t="letter":e.key.match(/^[0-9]$/)?t="number":"Backspace"===e.key?t="backspace":"Enter"===e.key?t="enter":" "===e.key?t="space":e.key.startsWith("Arrow")?t="navigation":(e.ctrlKey||e.metaKey||e.altKey)&&(t="modifier"),u.push({timestamp:Date.now(),keyType:t,key:e.key})}),100);document.addEventListener("keydown",e)}if(_){const e=()=>{l||(l=Date.now()-r,document.removeEventListener("click",e),document.removeEventListener("keydown",e),document.removeEventListener("input",e))};document.addEventListener("click",e),document.addEventListener("keydown",e),document.addEventListener("input",e)}if(b){(async()=>{const r={};r.os=navigator.userAgentData?.platform||navigator.platform||"unknown",r.browser=navigator.userAgentData?.brands?.[0]?.brand||navigator.userAgent.match(/(Chrome|Firefox|Safari|Edge)\/[\d.]+/)?.[0]||"Unknown",r.screenResolution=`${screen.width}x${screen.height}`,r.colorDepth=screen.colorDepth,r.deviceMemory=e?navigator.deviceMemory||"unknown":"unsupported",r.hardwareConcurrency=t?navigator.hardwareConcurrency||"unknown":"unsupported",r.timezone=a?Intl.DateTimeFormat().resolvedOptions().timeZone:"unsupported",r.language=navigator.language,r.platform=navigator.userAgentData?.platform||navigator.platform||"unknown",r.cookieEnabled=navigator.cookieEnabled;try{const e=document.createElement("canvas"),t=e.getContext("2d");t.textBaseline="top",t.font="14px Arial",t.fillText("Device fingerprint test ðŸ”’",2,2),r.canvasFingerprint=e.toDataURL().substring(0,100)}catch(e){r.canvasFingerprint="unavailable"}try{const e=document.createElement("canvas"),t=e.getContext("webgl")||e.getContext("experimental-webgl");if(t){const e=t.getExtension("WEBGL_debug_renderer_info");r.webglVendor=e?t.getParameter(e.UNMASKED_VENDOR_WEBGL):"unknown",r.webglRenderer=e?t.getParameter(e.UNMASKED_RENDERER_WEBGL):"unknown",r.gpu=r.webglRenderer}else r.webglVendor="unavailable",r.webglRenderer="unavailable",r.gpu="unavailable"}catch(e){r.webglVendor="error",r.webglRenderer="error",r.gpu="error"}if(n)try{const e=new(window.AudioContext||window.webkitAudioContext),t=e.createOscillator(),n=e.createAnalyser(),a=e.createGain();t.type="triangle",t.frequency.setValueAtTime(1e4,e.currentTime),a.gain.setValueAtTime(0,e.currentTime),t.connect(n),n.connect(a),a.connect(e.destination),t.start(0),setTimeout((()=>{const a=new Float32Array(n.frequencyBinCount);n.getFloatFrequencyData(a);let o=0;for(let e=0;e<a.length;e++)o+=Math.abs(a[e]);r.audioFingerprint=o.toString(),t.stop(),e.close()}),100)}catch(e){r.audioFingerprint="error"}else r.audioFingerprint="unsupported";try{const e=["monospace","sans-serif","serif"],t=["Arial","Arial Black","Arial Narrow","Arial Rounded MT Bold","Calibri","Cambria","Comic Sans MS","Consolas","Courier","Courier New","Georgia","Helvetica","Impact","Lucida Console","Lucida Sans Unicode","Microsoft Sans Serif","MS Gothic","MS PGothic","MS Sans Serif","MS Serif","Palatino Linotype","Segoe UI","Tahoma","Times","Times New Roman","Trebuchet MS","Verdana","Wingdings"],n="mmmmmmmmmmlli",a="72px",o=document.getElementsByTagName("body")[0],i=document.createElement("span");i.style.fontSize=a,i.innerHTML=n;const s={},c={};for(let t=0;t<e.length;t++)i.style.fontFamily=e[t],o.appendChild(i),s[e[t]]=i.offsetWidth,c[e[t]]=i.offsetHeight,o.removeChild(i);const d=[];for(let n=0;n<t.length;n++){let a=!1;for(let r=0;r<e.length;r++){i.style.fontFamily=t[n]+","+e[r],o.appendChild(i);const d=i.offsetWidth!==s[e[r]]||i.offsetHeight!==c[e[r]];o.removeChild(i),a=a||d}a&&d.push(t[n])}r.fonts=d}catch(e){r.fonts=["detection_failed"]}return r})().then((e=>{g=e})).catch((()=>{g={os:navigator.userAgentData?.platform||navigator.platform||"unknown",browser:navigator.userAgentData?.brands?.[0]?.brand||navigator.userAgent.match(/(Chrome|Firefox|Safari|Edge)\/[\d.]+/)?.[0]||"Unknown",screenResolution:`${screen.width}x${screen.height}`,colorDepth:screen.colorDepth,deviceMemory:e?navigator.deviceMemory||"unknown":"unsupported",hardwareConcurrency:t?navigator.hardwareConcurrency||"unknown":"unsupported",timezone:a?Intl.DateTimeFormat().resolvedOptions().timeZone:"unsupported",language:navigator.language,platform:navigator.userAgentData?.platform||navigator.platform||"unknown",error:"comprehensive_fingerprinting_failed"}}))}let A=0,x=0,T=0;if(h){const e=()=>A++,t=()=>x++;document.addEventListener("copy",e),document.addEventListener("paste",t)}if(E){const e=()=>T++;document.addEventListener("contextmenu",e)}document.getElementById("answerForm").addEventListener("submit",(async e=>{e.preventDefault();const t=document.getElementById("submitButton"),n=t.textContent;t.disabled=!0,t.innerHTML="Submitting...",t.classList.add("loading");const a=document.querySelector('input[name="answer_type"]')?.value;let v;if("radiobutton"===a?v=document.querySelector('input[name="answer"]:checked')?.value:"multiinput"===a?v=Array.from(document.querySelectorAll('input[name="answer"]:checked')).map((e=>e.value)):"textarea"===a?v=document.querySelector('textarea[name="answer"]').value.trim():"multiTextInput"===a&&(v=Array.from(document.querySelectorAll('input[name^="answer-"]')).map((e=>e.value.trim())).filter((e=>""!==e))),!v||Array.isArray(v)&&0===v.length)return t.disabled=!1,t.innerHTML=n,t.classList.remove("loading"),void alert("Please provide an answer before submitting.");const L=document.querySelector('input[name="test_id"]')?.value,M=document.querySelector('input[name="question_id"]')?.value,F=document.querySelector('input[name="user_id"]')?.value,q=Date.now()-r,R=y&&m?(Date.now()-m)/1e3:0;let I=C;"inactive"===S&&(I+=Date.now()-D);const B=(e,t=1e3)=>e.slice(0,t),V={test_id:L,question_id:M,profile_id:F,answer:v,time_taken:Math.round(q/1e3),ip:o,copy_count:A,paste_count:x,right_click_count:T,inactive_time:Math.round(I/1e3),start_time:new Date(r).toISOString(),submit_time:(new Date).toISOString(),device_type:p};w&&(i.length>0&&(i[i.length-1].duration_ms=Date.now()-D),V.focus_events=B(i)),h&&(V.clipboard_events=B(s)),y&&(V.pre_submit_delay=R),f&&(V.answer_change_events=B(c)),b&&(V.device_fingerprint=g),_&&(V.time_to_first_interaction=l?l/1e3:0),E&&(V.mouse_click_events=B(d)),k&&(V.keyboard_press_events=B(u));const N=document.querySelector('input[name="result_salt"]')?.value,W=((e,t)=>{const n=JSON.stringify(e),a=(new TextEncoder).encode(n),r=(new TextEncoder).encode(t),o=a.map(((e,t)=>e^r[t%r.length])),i=String.fromCharCode(...o);return btoa(i)})(V,F+N);try{if(!(await fetch(e.target.action,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",trc:navigator.userAgent},body:"hashed_payload="+encodeURIComponent(W)})).ok)throw new Error("Server responded with an error");window.location.reload()}catch(e){t.disabled=!1,t.innerHTML=n,t.classList.remove("loading"),console.error("Error:",e),alert("An error occurred. Please try again.")}}))};startScript();